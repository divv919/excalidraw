model User {
  id           String    @id @default(uuid())
  email        String    @unique
  password     String
  username     String
  adminOfRooms Room[]    @relation("RoomAdmin")  // Rooms this user admins
  accesses     Access[]
  content      Content[]
}

model Room {
  id           String    @id @default(uuid())
  slug         String    @unique
  created_at   DateTime  @default(now())
  content      Content[]
  invite_link  String    @unique
  is_protected Boolean   @default(false)
  password     String?
  admin_id     String    // Removed @unique - allows users to admin multiple rooms
  admin        User      @relation("RoomAdmin", fields: [admin_id], references: [id])
  accesses     Access[]
}

enum Role {
  user
  admin
  moderator
}

model Access {
  id        String  @id @default(uuid())
  room_id   String
  room      Room    @relation(fields: [room_id], references: [id], onDelete: Cascade)
  user_id   String
  user      User    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  role      Role    @default(user)
  is_banned Boolean @default(false)
  
  @@unique([user_id, room_id])
}

enum Shape {
  ellipse
  square
  pencil
  line
  arrow
  text
}

model Content {
  id         String   @id @default(uuid())
  user_id    String
  user       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
  created_at DateTime @default(now())
  room_id    String
  room       Room     @relation(fields: [room_id], references: [id], onDelete: Cascade)
  text       String?
  type       Shape
  clientX    Int?
  clientY    Int?
  height     Int?
  width      Int?
  radiusX    Int?
  radiusY    Int?
  fromX      Int?
  fromY      Int?
  toX        Int?
  toY        Int?
  points     Json?
}